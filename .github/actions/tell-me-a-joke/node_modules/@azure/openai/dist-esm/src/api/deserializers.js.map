{"version":3,"file":"deserializers.js","sourceRoot":"","sources":["../../../src/api/deserializers.ts"],"names":[],"mappings":"AAAA,uCAAuC;AACvC,kCAAkC;AAqBlC,SAAS,qBAAqB,CAAC,IAAyB;;IAGtD,MAAM,GAAG,GAAG,MAAA,IAAI,CAAC,oBAAoB,CAAC,mCAAI,IAAI,CAAC,uBAAuB,CAAC,CAAC;IACxE,OAAO,CAAC,GAAG;QACT,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,mBAAmB,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC,CAA2B,EAAE,EAAE,CAAC,iBAC5D,WAAW,EAAE,CAAC,CAAC,cAAc,CAAC,IAC3B,CAAC,CAAC,CAAC,CAAC,sBAAsB;gBAC3B,CAAC,CAAC,EAAE;gBACJ,CAAC,CAAC;oBACE,oBAAoB,EAAE,wBAAwB,CAAC,CAAC,CAAC,sBAAsB,CAAC;iBACzE,CAAC,EACN,CAAC;SACJ,CAAC;AACR,CAAC;AAED,MAAM,UAAU,oBAAoB,CAAC,IAAyB;;IAC5D,qCACE,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,EACd,OAAO,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,IAC/B,qBAAqB,CAAC,IAAI,CAAC,KAC9B,OAAO,EAAE,CAAC,MAAA,IAAI,CAAC,SAAS,CAAC,mCAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAe,EAAE,EAAE,CAAC,+BACxD,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,EACf,KAAK,EAAE,CAAC,CAAC,OAAO,CAAC,IACd,CAAC,CAAC,CAAC,CAAC,sBAAsB;YAC3B,CAAC,CAAC,EAAE;YACJ,CAAC,CAAC;gBACE,oBAAoB,EAAE,wBAAwB,CAAC,CAAC,CAAC,sBAAsB,CAAC;aACzE,CAAC,KACN,QAAQ,EACN,CAAC,CAAC,QAAQ,KAAK,IAAI;gBACjB,CAAC,CAAC,IAAI;gBACN,CAAC,CAAC;oBACE,MAAM,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC;oBAC5B,aAAa,EAAE,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC;oBAC3C,WAAW,EAAE,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC;oBACvC,UAAU,EAAE,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC;iBACtC,EACP,YAAY,EAAE,CAAC,CAAC,eAAe,CAAC,IAChC,CAAC,IACH;AACJ,CAAC;AAED,MAAM,UAAU,wBAAwB,CAAC,IAAyB;;IAChE,qCACE,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,EACd,OAAO,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAClC,OAAO,EAAE,CAAC,MAAA,IAAI,CAAC,SAAS,CAAC,mCAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAmB,EAAE,EAAE,CAAC,6DACzD,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,mBAAmB,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,KAClE,KAAK,EAAE,CAAC,CAAC,OAAO,CAAC,EACjB,YAAY,EAAE,CAAC,CAAC,eAAe,CAAC,KAC7B,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,mBAAmB,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,GACzD,CAAC,CAAC,CAAC,CAAC,sBAAsB;YAC3B,CAAC,CAAC,EAAE;YACJ,CAAC,CAAC,EAAE,oBAAoB,EAAE,wBAAwB,CAAC,CAAC,CAAC,sBAAsB,CAAC,EAAE,CAAC,EACjF,CAAC,IACA,qBAAqB,CAAC,IAAI,CAAC,GAC3B,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;QAChB,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,KAAK,EAAE;gBACL,gBAAgB,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,iBAAiB;gBACjD,YAAY,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,aAAa;gBACzC,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,YAAY;aACxC;SACF,CAAC,EACN;AACJ,CAAC;AAED,SAAS,mBAAmB,CAAC,OAA0B;;IACrD,iFAMK,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAE,EAAyB,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC,GAC3E,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAE,EAA0B,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC,GACrF,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC,GACnD,CAAC,CAAC,OAAO,CAAC,aAAa;QACxB,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,YAAY,EAAE;gBACZ,IAAI,EAAE,MAAA,OAAO,CAAC,aAAa,0CAAG,MAAM,CAAC;gBACrC,SAAS,EAAE,MAAA,OAAO,CAAC,aAAa,0CAAG,WAAW,CAAC;aAChD;SACF,CAAC,GACH,CAAC,CAAC,OAAO,CAAC,OAAO;QAClB,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,OAAO,oBACF,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ;gBAC3B,CAAC,CAAC,EAAE;gBACJ,CAAC,CAAC;oBACE,QAAQ,EAAE,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE;wBAC3C,OAAO,mBAAmB,CAAC,CAAC,CAAC,CAAC;oBAChC,CAAC,CAAC;iBACH,CAAC,CACP;SACF,CAAC,EACN;AACJ,CAAC;AAED,SAAS,wBAAwB,CAAC,MAAkC;;IAClE,IAAI,MAAM,CAAC,KAAK,EAAE;QAChB,OAAO;YACL,KAAK,EAAE;gBACL,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,IAAI;gBACvB,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO;gBAC7B,OAAO,EAAE,MAAA,MAAM,CAAC,KAAK,CAAC,OAAO,mCAAI,EAAE;aACpC;SACF,CAAC;KACH;IACD,mEACK,CAAC,CAAC,MAAM,CAAC,MAAM;QAChB,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,MAAM,EAAE;gBACN,QAAQ,EAAE,MAAA,MAAM,CAAC,MAAM,0CAAG,UAAU,CAAC;gBACrC,QAAQ,EAAE,MAAA,MAAM,CAAC,MAAM,0CAAG,UAAU,CAAC;aACtC;SACF,CAAC,GACH,CAAC,CAAC,MAAM,CAAC,QAAQ;QAClB,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,QAAQ,EAAE;gBACR,QAAQ,EAAE,MAAA,MAAM,CAAC,QAAQ,0CAAG,UAAU,CAAC;gBACvC,QAAQ,EAAE,MAAA,MAAM,CAAC,QAAQ,0CAAG,UAAU,CAAC;aACxC;SACF,CAAC,GACH,CAAC,CAAC,MAAM,CAAC,IAAI;QACd,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,IAAI,EAAE;gBACJ,QAAQ,EAAE,MAAA,MAAM,CAAC,IAAI,0CAAG,UAAU,CAAC;gBACnC,QAAQ,EAAE,MAAA,MAAM,CAAC,IAAI,0CAAG,UAAU,CAAC;aACpC;SACF,CAAC,GACH,CAAC,CAAC,MAAM,CAAC,SAAS;QACnB,CAAC,CAAC,EAAE;QACJ,CAAC,CAAC;YACE,QAAQ,EAAE;gBACR,QAAQ,EAAE,MAAA,MAAM,CAAC,SAAS,0CAAG,UAAU,CAAC;gBACxC,QAAQ,EAAE,MAAA,MAAM,CAAC,SAAS,0CAAG,UAAU,CAAC;aACzC;SACF,CAAC,EACN;AACJ,CAAC","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * THIS IS AN AUTO-GENERATED FILE - DO NOT EDIT!\n *\n * Any changes you make here may be lost.\n *\n * If you need to make changes, please do so in the original source file, \\{project-root\\}/sources/custom\n */\n\nimport { ChatMessage, ChatRole, Completions, PromptFilterResult } from \"../models/models.js\";\nimport {\n  ChatChoiceOutput,\n  ChatMessageOutput,\n  ChoiceOutput,\n  ContentFilterResultsOutput,\n  PromptFilterResultOutput,\n} from \"../rest/outputModels.js\";\nimport { ChatCompletions } from \"../models/models.js\";\nimport { ContentFilterResults } from \"./models.js\";\n\nfunction getPromptFilterResult(body: Record<string, any>): {\n  promptFilterResults?: PromptFilterResult[];\n} {\n  const res = body[\"prompt_annotations\"] ?? body[\"prompt_filter_results\"];\n  return !res\n    ? {}\n    : {\n        promptFilterResults: res.map((p: PromptFilterResultOutput) => ({\n          promptIndex: p[\"prompt_index\"],\n          ...(!p.content_filter_results\n            ? {}\n            : {\n                contentFilterResults: deserializeContentFilter(p.content_filter_results),\n              }),\n        })),\n      };\n}\n\nexport function getCompletionsResult(body: Record<string, any>): Omit<Completions, \"usage\"> {\n  return {\n    id: body[\"id\"],\n    created: new Date(body[\"created\"]),\n    ...getPromptFilterResult(body),\n    choices: (body[\"choices\"] ?? []).map((p: ChoiceOutput) => ({\n      text: p[\"text\"],\n      index: p[\"index\"],\n      ...(!p.content_filter_results\n        ? {}\n        : {\n            contentFilterResults: deserializeContentFilter(p.content_filter_results),\n          }),\n      logprobs:\n        p.logprobs === null\n          ? null\n          : {\n              tokens: p.logprobs[\"tokens\"],\n              tokenLogprobs: p.logprobs[\"token_logprobs\"],\n              topLogprobs: p.logprobs[\"top_logprobs\"],\n              textOffset: p.logprobs[\"text_offset\"],\n            },\n      finishReason: p[\"finish_reason\"],\n    })),\n  };\n}\n\nexport function getChatCompletionsResult(body: Record<string, any>): ChatCompletions {\n  return {\n    id: body[\"id\"],\n    created: new Date(body[\"created\"]),\n    choices: (body[\"choices\"] ?? []).map((p: ChatChoiceOutput) => ({\n      ...(!p.message ? {} : { message: _deserializeMessage(p.message) }),\n      index: p[\"index\"],\n      finishReason: p[\"finish_reason\"],\n      ...(!p.delta ? {} : { delta: _deserializeMessage(p.delta) }),\n      ...(!p.content_filter_results\n        ? {}\n        : { contentFilterResults: deserializeContentFilter(p.content_filter_results) }),\n    })),\n    ...getPromptFilterResult(body),\n    ...(!body[\"usage\"]\n      ? {}\n      : {\n          usage: {\n            completionTokens: body[\"usage\"].completion_tokens,\n            promptTokens: body[\"usage\"].prompt_tokens,\n            totalTokens: body[\"usage\"].total_tokens,\n          },\n        }),\n  };\n}\n\nfunction _deserializeMessage(message: ChatMessageOutput): ChatMessage {\n  return {\n    /**\n     * Treating the role and content as optional is because they may not be returned\n     * during the streaming mode. The type should be updated for the streaming mode\n     * and it is a TODO.\n     */\n    ...(!message[\"role\"] ? ({} as { role: ChatRole }) : { role: message[\"role\"] }),\n    ...(!message[\"content\"] ? ({} as { content: string }) : { content: message[\"content\"] }),\n    ...(!message[\"name\"] ? {} : { name: message[\"name\"] }),\n    ...(!message.function_call\n      ? {}\n      : {\n          functionCall: {\n            name: message.function_call?.[\"name\"],\n            arguments: message.function_call?.[\"arguments\"],\n          },\n        }),\n    ...(!message.context\n      ? {}\n      : {\n          context: {\n            ...(!message.context.messages\n              ? {}\n              : {\n                  messages: message.context.messages.map((m) => {\n                    return _deserializeMessage(m);\n                  }),\n                }),\n          },\n        }),\n  };\n}\n\nfunction deserializeContentFilter(result: ContentFilterResultsOutput): ContentFilterResults {\n  if (result.error) {\n    return {\n      error: {\n        code: result.error.code,\n        message: result.error.message,\n        details: result.error.details ?? [],\n      },\n    };\n  }\n  return {\n    ...(!result.sexual\n      ? {}\n      : {\n          sexual: {\n            severity: result.sexual?.[\"severity\"],\n            filtered: result.sexual?.[\"filtered\"],\n          },\n        }),\n    ...(!result.violence\n      ? {}\n      : {\n          violence: {\n            severity: result.violence?.[\"severity\"],\n            filtered: result.violence?.[\"filtered\"],\n          },\n        }),\n    ...(!result.hate\n      ? {}\n      : {\n          hate: {\n            severity: result.hate?.[\"severity\"],\n            filtered: result.hate?.[\"filtered\"],\n          },\n        }),\n    ...(!result.self_harm\n      ? {}\n      : {\n          selfHarm: {\n            severity: result.self_harm?.[\"severity\"],\n            filtered: result.self_harm?.[\"filtered\"],\n          },\n        }),\n  };\n}\n"]}